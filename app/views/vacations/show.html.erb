<h1><%= "#{@vacation.name} starting on #{@vacation.start_date.strftime('%m/%d/%Y')}"%></h1>
<% if flash[:errors].present? %>
  <h2>
    <%= pluralize(flash[:errors].count, "error") %>
    prohibited this reservation from being booked:
  </h2>
  <ul>
    <% flash[:errors].each do |message|%>
      <li>
        <%= message %>
      </li>
    <% end%>
  </ul>
<% end %>
<%= render "show-helper" %>
<br>
<div class="container">
  <div class="row">
    <% if !@vacation.need_to_book_hotel? %>
      <div class="col-sm button">
        <%= " " %>
      </div>
      <div class="col-1 button">
        <%= " " %>
      </div>
      <div class="col-sm button">
        <% if !@vacation.hotels.empty? %>
          <%= button_to "Delete the most recent hotel", @vacation.hotel_stays.max_by(&:check_out_time), {method: :delete, id: "delete-hotel"} %>
          <br>
          <br>
          <br>
        <% end %>
      </div>
      <br>
      <nav class = "navbar fixed-bottom navbar-expand-lg navbar-light bg-light">
        <a class= "navbar-brand">Search for your next flight!</a>
        <%= form_tag "/flights/search/#{@vacation.id}", :method => "get", :class => "form-inline" do %>
          <label class = "my-1 mr-2">Origin:</label>
          <% if !@vacation.cur_city.nil? %>
            <strong><%= @vacation.cur_city.name %></strong>
            &ensp;
            <%= hidden_field_tag "flight[origin_id]", @vacation.cur_city.id  %>
          <% else %>
            <%= collection_select :flight, :origin_id, @cities, :id, :name, {prompt: "Please select origin"}, {class: "form-control mr-sm-2"} %>
          <% end %>
          <label class = "my-1 mr-2"> Destination:</label>
          <%= collection_select :flight, :destination_id, @cities, :id, :name, {prompt: "Please select destination"}, {class: "form-control mr-sm-2"} %>
          <label class = "my-1 mr-2" >Approx. Departure:</label>
          <%= datetime_field_tag("flight[start_time]", nil, {class: "form-control mr-sm-2 datetime-local"})%>
          <%= submit_tag 'Search', class: "btn btn-primary" %>
        <% end %>
      </nav>
    <% else %>
      <div class="col-sm button">
        <%= button_to "Delete the most recent flight", @most_recent_flight, {method: :delete, id: "delete-flight"} %>
        <br>
        <br>
        <br>
      </div>
      <div class="col-1 button">
        <% if @vacation.first_origin == @vacation.cur_city && !@vacation.flights.empty? %>
          <%= button_to "Finalize trip", finalize_vacation_path(@vacation)%>
        <% end %>
      </div>
      <div class="col-sm button">
        <%= " "%>
      </div>
      <br>
    </div>
  </div>
  <nav class = "navbar fixed-bottom navbar-expand-lg navbar-light bg-light">
    <a class= "navbar-brand"> Add a hotel!</a>
    <%= form_for HotelStay.new, html: {class: "form-inline"}  do |f| %>
      <% hotel_list = Hotel.all.select do |hotel| %>
        <% hotel.city == @vacation.cur_city %>
      <% end%>
      <%= f.collection_select :hotel_id, hotel_list, :id, :name, {prompt: "Pick a hotel"}, {class: "form-control mr-sm-2"} %>
      <label class = "my-1 mr-2">Check in time:</label>
      <%= f.datetime_field :check_in_time, class: "form-control mr-sm-2 datetime-local" %>
      <label class = "my-1 mr-2">Check out time:</label>
      <%= f.datetime_field :check_out_time, class: "form-control mr-sm-2 datetime-local"%>
      <%= f.hidden_field :vacation_id, value: @vacation.id %>
      <%= f.submit "Book a hotel", class: "btn btn-primary"%>
    <% end %>
  </nav>
<% end %>
